samples:
  # two raw files are incomplete
  gate: >-
    date == "2021-10-03" & 
    sample == ["MS_421", "MS_422", "MS_423", "MS_424", "MS_429", "MS_430", "MS_431", 
    "MS_432", "MS_437", "MS_438", "MS_439", "MS_440", "MS_445", "MS_446", "MS_447", 
    "MS_448", "MS_453", "MS_454", "MS_455", "MS_456", "MS_460", "MS_461", "MS_462", 
    "MS_466", "MS_467", "MS_468", "MS_469", "MS_473", "MS_474", "MS_475", "MS_476"]
    & sample != ["MS_445", "MS_455", "MS_469"]

designs:
  table: /home/dfeldman/flycodes/chip_orders/chip162_designs.csv.gz
  gate: library == "BC_minibinders_pos"
  rename:
    design_name_original: pdb_file

convert_raw:
  flags: [
    # '--noPeakPicking'
    ]

process_mzml:
  snakefile: /home/dfeldman/packages/postdoc/scripts/ms/process_mzml.smk
  request: 'filtered'
  mzML_filter: -rt 600:2700 -mz 400:860
  comet_params: /home/dfeldman/packages/postdoc/scripts/ms/comet_lowres.params
  idXML_filter: -score:pep 30 -mz:error 10
  mz_calibration: -offset 0 -ms_level 1
  rt_reference: MS_418
  rt_calibration: -model:b_spline:num_nodes 10 -algorithm:max_rt_shift 60

skyline:
  input_tag: 'filtered'
  gui_settings:
    peaks: 3
    mass_accuracy: 3 ppm
    rt_filtering: 0.75 minutes
  qc_gate: >-
    -2 < mass_error_ppm < 2
    & 0.8 < isotope_dot_product
  barcode_count_gate: stage == "SEC" & 1e6 < area_ms1

intensities:
  gates: 
    # barcode measurements outside this gate are shown as hollow circles in SEC plots
    plot_barcode: >-
      -2 < mass_error_ppm < 2
      & 0.8 < isotope_dot_product

plot:
  by_design:
    job_size: 100
  barcode_stats:
    detected_cutoff: 5
  stage_order: ['R1 insoluble', 'R1 soluble', 'R1 injection', 'R2 injection', 'SEC']

sec:
  barcode:
    # barcode measurements outside this gate are missing values in SEC traces
    gate: stage == "SEC" & plot_barcode & 1e6 < area_ms1
    intensity_metric: 'area_ms1'
    # data points with higher 2nd derivative (diff, then convolve [-1, 1]) are removed
    crap_threshold: 0.4
  consensus:
    # barcodes to include in consensus calculation
    gate: max_consecutive_missing < 4 & num_missing < 4
    method: 'median'
    # parameters for consensus metrics
    deviation_threshold: 0.02
    volume_windows:
      aggregate: [10.3, 13.6]
      oligomer: [12.5, 15.5]
      monomer: [16, 19]
  rank_plots:
    # all:
    #   gate: >- 
    #      1 <= num_consensus_barcodes
    #   sort_ascending: [mean_abs_distance, mean_wass_distance, mean_deviation_count]
    #   sort_descending: [monomer, oligomer, aggregate, median_l2]
    multi:
      gate: >- 
         2 <= num_consensus_barcodes
      sort_ascending: [mean_deviation_count]
      sort_descending: [monomer, oligomer, aggregate, median_l2]

ngs:
  result_table: /home/dfeldman/NGS/20210919_DF/results/pTL12.40.matched.csv

