samples:
  gate: date == "2021-08-06" & "MS_191" <= sample <= "MS_229"

designs:
  table: /home/dfeldman/flycodes/chip_orders/chip137_design_rick_rolls.csv
  gate: vector == "pT12"

convert_raw:
  flags: [
    # '--noPeakPicking'
    ]

# 1. calibrate mz
# 2. calibrate rT? already within 20 seconds...
ms_preprocess:
  comet_params: /home/dfeldman/packages/postdoc/scripts/ms/comet_lowres.params
  mzML_filter: -rt 600:2700 -mz 400:850
  idXML_filter: -score:pep 100 -mz:error 10
  mz_calibration: -ppm_match_tolerance 4 -RT_chunking -1 -ms_level 1
  rt_reference: MS_193
  rt_calibration: -model:b_spline:num_nodes 10 -algorithm:max_rt_shift 60

skyline:
  # some parameters set manually in the GUI
  # - # of isotopes/transitions
  # - max time distance to MS/MS IDs
  #

intensities:
  # TODO: not implemented yet for skyline
  rt-fit:
    fit_gate: '-5 < mass_error_ppm < 0 & 0.9 < isotope_dot_product & 1e7 < area_ms1'
  gates: 
    # barcode measurements outside this gate are shown as hollow circles in SEC plots
    plot_barcode: >-
      17.5 < retention_time
      & -5 < mass_error_ppm < 0
      & 0.75 < isotope_dot_product

plot:
  by_design:
    job_size: 40
  barcode_stats:
    detected_cutoff: 5
  stage_order: ['insoluble', 'soluble', 'injection', 'SEC']

sec:
  barcode:
    # barcode measurements outside this gate are missing values in SEC traces
    gate: stage == "SEC" & plot_barcode & 1e6 < area_ms1
    intensity_metric: 'area_ms1'
    # data points with higher 2nd derivative (diff, then convolve [-1, 1]) are removed
    crap_threshold: 0.4
  consensus:
    # barcodes to include in consensus calculation
    gate: max_consecutive_missing < 2 & num_missing < 4 & Y_count < 4 & not crap
    method: 'median'
    # parameters for consensus metrics
    deviation_threshold: 0.02
    volume_windows:
      aggregate: [10.3, 13.6]
      oligomer: [12.5, 15.5]
      monomer: [16, 19]
  rank_plots:
    - prefix: 
      gate: '3 <= num_barcodes <= 5 & 12 < peak_center < 18 & 0.27 < median_l2 & mean_deviation_count < 4'
      sort_ascending: [mean_abs_distance, mean_wass_distance, mean_deviation_count]
      sort_descending: [monomer, oligomer, aggregate, median_l2]



